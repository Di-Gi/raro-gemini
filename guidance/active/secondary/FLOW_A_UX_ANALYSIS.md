# Flow A: Architect - UX Workflow Analysis

## The Core Question

**When should the DAG be generated, verified, and executed?**

This affects:
- User trust and control
- Speed vs safety trade-off
- Learning and transparency
- Error recovery

---

## Workflow Options

### Option 1: Implicit Auto-Generate (Fastest)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [Text Input: "Research quantum computing"]                 â”‚
â”‚  [ â†µ RUN ]  â† Single click                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
    (Background)
    1. Generate DAG from text
    2. Overwrite store
    3. Execute immediately
         â†“
    User sees execution start
```

**Pros:**
- âœ… Fastest: One click from idea to execution
- âœ… Clean UX: No intermediate steps
- âœ… "Just works" magic feeling

**Cons:**
- âŒ No visibility into what was generated
- âŒ No chance to correct mistakes
- âŒ Hard to learn what the AI decided
- âŒ If AI generates wrong plan, execution starts anyway

**Best for:** Trusted AI, experienced users, low-stakes tasks

---

### Option 2: Auto-Generate + Review Before Execute (Balanced)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [Text Input: "Research quantum computing"]                 â”‚
â”‚  [ GENERATE PLAN ]  â† First click                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
    Loading...
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Generated Plan: 4 agents                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  [ORCHESTRATOR] â†’ [RESEARCHER] â†’ [ANALYST] â†’ [SYNTH]  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                              â”‚
â”‚  You can:                                                    â”‚
â”‚  - Click nodes to edit prompts                              â”‚
â”‚  - Drag nodes to reposition                                 â”‚
â”‚  - Click edges to modify dependencies                       â”‚
â”‚                                                              â”‚
â”‚  [ âœ“ LOOKS GOOD, EXECUTE ]  [ âœ— CANCEL ]  [ â†» REGENERATE ] â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
    User clicks "EXECUTE"
         â†“
    Execution starts
```

**Pros:**
- âœ… User sees what was generated
- âœ… Can catch obvious errors
- âœ… Educational: Learn AI's planning
- âœ… Can edit before execution
- âœ… Builds trust through transparency

**Cons:**
- âš ï¸ Two clicks instead of one
- âš ï¸ Requires review step (adds friction)

**Best for:** New users, important tasks, learning mode

---

### Option 3: Toggle-Based Hybrid (Flexible)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Mode: [ Manual Graph ] [ AI-Assisted ğŸ¤– ] â† Toggle         â”‚
â”‚                                                              â”‚
â”‚  [Text Input: "Research quantum computing"]                 â”‚
â”‚  [ â†µ RUN ]                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

If "Manual Graph" mode:
    â†’ Uses existing graph + appends query to orchestrator
    â†’ Current behavior (preserved)

If "AI-Assisted" mode:
    â†’ Sub-choice: [Auto-Execute] or [Review First]
    â†’ User preference saved
```

**Pros:**
- âœ… Preserves existing manual workflow
- âœ… Lets users choose their preference
- âœ… Can switch modes per task
- âœ… Advanced users can go fast, new users can go safe

**Cons:**
- âš ï¸ More UI complexity
- âš ï¸ Settings to manage

**Best for:** Production system with mixed user base

---

### Option 4: Two-Stage Process with Visual Diff (Most Control)

```
Stage 1: PLANNING
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“ Planning Mode                                            â”‚
â”‚  [Text Input: "Research quantum computing"]                 â”‚
â”‚  [ GENERATE PLAN ]                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Generated Plan Preview:                                     â”‚
â”‚                                                              â”‚
â”‚  Current Graph (4 nodes)  â†’  New Plan (5 nodes)            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚ n1 â†’ n2 â†’ n4   â”‚          â”‚ research_agent  â”‚          â”‚
â”‚  â”‚   â†˜  n3 â†—      â”‚    VS    â”‚    â†“            â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚ data_collector  â”‚          â”‚
â”‚                                â”‚    â†“            â”‚          â”‚
â”‚                                â”‚ analyzer        â”‚          â”‚
â”‚                                â”‚    â†“            â”‚          â”‚
â”‚                                â”‚ fact_checker    â”‚          â”‚
â”‚                                â”‚    â†“            â”‚          â”‚
â”‚                                â”‚ synthesizer     â”‚          â”‚
â”‚                                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                                              â”‚
â”‚  [ ACCEPT & SWITCH TO EXECUTION MODE ]                      â”‚
â”‚  [ KEEP CURRENT GRAPH ]                                     â”‚
â”‚  [ REGENERATE WITH DIFFERENT APPROACH ]                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
Stage 2: EXECUTION
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â–¶ï¸ Execution Mode                                           â”‚
â”‚  [Graph now shows 5 nodes from AI plan]                     â”‚
â”‚  [ â–¶ EXECUTE ]                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Pros:**
- âœ… Clear separation: Plan vs Execute
- âœ… Shows before/after diff
- âœ… Can keep old graph if preferred
- âœ… Explicit mode switching
- âœ… Feels professional/powerful

**Cons:**
- âš ï¸ Most clicks
- âš ï¸ Most UI complexity

**Best for:** Complex workflows, professional tools, high-stakes tasks

---

## Recommended Workflow

### **Proposal: Progressive Disclosure with Smart Defaults**

Combine the best of Options 2 and 3:

```
Default Behavior (First Time User):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ’¬ Directive:                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Research quantum computing applications                â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                              â”‚
â”‚  [ ğŸ¨ GENERATE PLAN ]  [ â–¶ USE CURRENT GRAPH ]             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**After clicking "GENERATE PLAN":**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  âœ¨ AI Generated Plan (4 agents, 3 seconds)                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚         [Graph visualization here]                     â”‚ â”‚
â”‚  â”‚  research_agent â†’ data_collector â†’ analyzer â†’ synth   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                              â”‚
â”‚  â„¹ï¸  This plan will:                                        â”‚
â”‚  1. Search academic papers for quantum computing            â”‚
â”‚  2. Extract key findings and applications                   â”‚
â”‚  3. Analyze trends and breakthroughs                        â”‚
â”‚  4. Synthesize comprehensive report                         â”‚
â”‚                                                              â”‚
â”‚  [ âœ“ EXECUTE THIS PLAN ]                                    â”‚
â”‚                                                              â”‚
â”‚  Advanced:                                                   â”‚
â”‚  [ âœï¸ Edit Graph ]  [ â†» Regenerate ]  [ âœ— Cancel ]         â”‚
â”‚                                                              â”‚
â”‚  â˜ Always execute generated plans immediately (skip review) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**After execution starts:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸƒ Executing: Research quantum computing applications      â”‚
â”‚  [Progress visualization with logs...]                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Why This Workflow?

### 1. **Safe Default** (Review First)
- New users see what AI generated
- Builds trust through transparency
- Educational value

### 2. **Progressive Enhancement** (Opt-in Speed)
- Checkbox: "Always execute immediately"
- Advanced users can skip review
- Preference remembered

### 3. **Escape Hatches**
- Cancel if plan looks wrong
- Regenerate with different approach
- Edit manually before execution

### 4. **Clear Actions**
- "GENERATE PLAN" = I want AI help
- "USE CURRENT GRAPH" = I built it manually
- No ambiguity

---

## Implementation States

### State 1: IDLE (Default)
```
User sees:
- Text input for directive
- Current graph (can be empty or pre-built)
- Two clear buttons
```

### State 2: GENERATING
```
User sees:
- Loading indicator
- "Consulting AI architect..."
- Cancel button (optional)
```

### State 3: PLAN_READY
```
User sees:
- Generated graph visualization
- Summary of what plan will do
- Execute button (primary action)
- Edit/Regenerate/Cancel (secondary actions)
```

### State 4: EXECUTING
```
User sees:
- Live execution progress
- Logs streaming
- Current behavior (already implemented)
```

---

## Alternative: Inline Preview

**For power users who want even faster workflow:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ’¬ Directive:                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Research quantum computingâ–ˆ                            â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                              â”‚
â”‚  ğŸ’¡ AI Suggestion (as you type):                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Suggested plan: 4 agents (researcher â†’ collector...)  â”‚ â”‚
â”‚  â”‚  [Preview] [Use this âœ“]                                â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                              â”‚
â”‚  [ GENERATE PLAN ]  [ USE CURRENT GRAPH ]                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Debounced suggestion as user types (like GitHub Copilot)**

---

## Edge Cases to Handle

### Case 1: Empty/No Graph
- If no existing graph, "USE CURRENT GRAPH" is disabled
- "GENERATE PLAN" is the primary CTA

### Case 2: Generation Fails
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  âŒ Plan Generation Failed                                   â”‚
â”‚  The AI couldn't generate a valid plan:                     â”‚
â”‚  "Query too vague. Please specify the research domain."     â”‚
â”‚                                                              â”‚
â”‚  [ â†» TRY AGAIN ]  [ USE CURRENT GRAPH ]                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Case 3: User Edits Generated Plan
- Mark graph as "Modified from AI plan"
- Allow saving as template
- Can regenerate to revert

### Case 4: Plan Already Generated
- If directive changes, show "Plan outdated, regenerate?"
- Visual indicator if graph doesn't match current input

---

## Technical Implementation Notes

### Store Management

```typescript
// Add new state to stores.ts

export const planningState = writable<{
  mode: 'idle' | 'generating' | 'plan_ready' | 'executing';
  generatedPlan: WorkflowConfig | null;
  originalQuery: string | null;
  lastGenerated: Date | null;
}>({
  mode: 'idle',
  generatedPlan: null,
  originalQuery: null,
  lastGenerated: null
});
```

### User Preferences

```typescript
// Add to localStorage or user settings

export const userPreferences = writable<{
  autoExecuteGeneratedPlans: boolean;
  showPlanSummary: boolean;
  rememberLastMode: boolean;
}>({
  autoExecuteGeneratedPlans: false, // Safe default
  showPlanSummary: true,
  rememberLastMode: false
});
```

---

## Recommended Implementation Order

### Phase 1: Core Flow (Minimal)
```
1. Add "GENERATE PLAN" button
2. Call /plan endpoint
3. Show loading state
4. Display generated graph
5. Add "EXECUTE" button
6. Wire to existing execution logic
```

### Phase 2: Review UI
```
7. Add plan summary/description
8. Add "Cancel" and "Regenerate" buttons
9. Visual graph diff (optional)
10. Edit capabilities
```

### Phase 3: Polish
```
11. Add user preference toggle
12. Remember last mode
13. Inline suggestions (optional)
14. Save plan templates
```

---

## My Recommendation

**Start with: Option 2 (Auto-Generate + Review)**

**Why:**
1. **Builds Trust:** Users see what AI decided
2. **Educational:** Learn from AI's planning
3. **Safe:** Catch errors before execution
4. **Simple:** Only 2 states to implement
5. **Upgradeable:** Easy to add auto-execute toggle later

**Implementation:**
```
Phase 1 (Day 1): Basic flow
- Button to generate
- Show result
- Button to execute

Phase 2 (Day 2): Add review features
- Summary of plan
- Regenerate option
- Cancel option

Phase 3 (Later): Add preferences
- Auto-execute toggle
- Save templates
- Inline suggestions
```

**Start minimal, iterate based on user feedback.**

---

## Questions to Decide

Before implementing, clarify:

1. **Primary Use Case:**
   - Research tasks (exploratory)
   - Repeated workflows (production)
   - Learning/experimentation

2. **User Trust Level:**
   - High trust â†’ Can skip review
   - Low trust â†’ Always review
   - Mixed â†’ Need toggle

3. **Error Tolerance:**
   - High stakes â†’ Must review
   - Low stakes â†’ Can auto-execute

4. **Iteration Needs:**
   - Users refine plans â†’ Need editing
   - One-shot tasks â†’ Just execute
