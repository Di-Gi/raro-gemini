<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RARO | Brutalist Runtime</title>
    <style>
        :root {
            /* Palette: Archival Concrete */
            --bg-paper: #E6E2DD;
            --bg-ink: #1A1918;
            --line-color: #3E3B39;
            --accent: #A53F2B; /* Rust */
            --highlight: #D4CDC5;
            
            /* Type */
            --font-mono: 'Courier Prime', 'Courier New', Courier, monospace;
            --font-sans: 'Helvetica Neue', Helvetica, Arial, sans-serif;
        }

        * { box-sizing: border-box; }

        body {
            margin: 0;
            background: var(--bg-paper);
            color: var(--bg-ink);
            font-family: var(--font-mono);
            height: 100vh;
            display: flex;
            justify-content: center;
            overflow: hidden;
        }

        /* The Monolith Container */
        #machine {
            width: 100%;
            max-width: 640px;
            height: 100vh;
            border-left: 1px solid var(--line-color);
            border-right: 1px solid var(--line-color);
            display: flex;
            flex-direction: column;
            background: var(--bg-paper);
        }

        /* --- Shared Border Utility --- */
        .block {
            border-bottom: 1px solid var(--line-color);
            padding: 16px;
            position: relative;
        }
        
        .no-border-bottom { border-bottom: none; }

        /* --- HEADER --- */
        header.block {
            display: flex;
            justify-content: space-between;
            align-items: baseline;
            padding: 12px 16px;
            background: var(--bg-ink);
            color: var(--bg-paper);
        }
        .brand { font-weight: 900; letter-spacing: -1px; font-size: 18px; text-transform: uppercase; }
        .meta { font-size: 11px; opacity: 0.7; }

        /* --- OUTPUT STREAM --- */
        #output-tape {
            flex: 1;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            justify-content: flex-end; /* Bottom-up feed */
            padding: 0;
            background: var(--bg-paper);
        }
        
        /* Artifact Blocks */
        .artifact {
            border-top: 1px solid var(--line-color);
            padding: 16px;
            animation: flash 0.2s ease;
        }
        @keyframes flash { from { background: var(--highlight); } to { background: transparent; } }

        .artifact-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 12px;
            font-size: 11px;
            text-transform: uppercase;
            font-weight: bold;
            letter-spacing: 1px;
        }
        
        .role-tag { background: var(--bg-ink); color: var(--bg-paper); padding: 2px 6px; }
        .user-tag { background: var(--line-color); color: var(--bg-paper); padding: 2px 6px; }

        .artifact-body {
            font-family: var(--font-sans);
            font-size: 14px;
            line-height: 1.4;
        }

        /* Glass Box Data */
        .signature-block {
            margin-top: 12px;
            border: 1px solid var(--line-color);
            font-size: 10px;
            display: grid;
            grid-template-columns: 80px 1fr;
        }
        .sig-label { border-right: 1px solid var(--line-color); padding: 4px; background: var(--highlight); }
        .sig-value { padding: 4px; font-family: var(--font-mono); overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }

        /* --- PIPELINE ( The Interaction Horizon ) --- */
        #pipeline-strip {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            border-top: 1px solid var(--line-color);
            border-bottom: 1px solid var(--line-color);
            height: 48px;
            user-select: none;
        }

        .pipe-node {
            display: flex;
            align-items: center;
            justify-content: center;
            border-right: 1px solid var(--line-color);
            cursor: pointer;
            font-size: 12px;
            font-weight: 700;
            transition: background 0.1s;
            position: relative;
        }
        .pipe-node:last-child { border-right: none; }
        .pipe-node:hover { background: var(--highlight); }
        
        /* Active/Running States */
        .pipe-node.running { background: var(--bg-ink); color: var(--bg-paper); }
        .pipe-node.running::after {
            content: 'BUSY'; position: absolute; top: 2px; right: 2px; font-size: 8px;
        }
        
        /* Expanded State (The Editor) */
        .pipe-node.expanded {
            background: var(--accent);
            color: white;
        }

        /* --- EDITOR DRAWER (Expands on Click) --- */
        #editor-drawer {
            display: none;
            background: var(--highlight);
            border-bottom: 1px solid var(--line-color);
            padding: 0;
        }
        #editor-drawer.open { display: block; }

        .editor-controls {
            padding: 16px;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }

        .control-group label { display: block; font-size: 10px; text-transform: uppercase; margin-bottom: 5px; }
        .brutalist-select {
            width: 100%;
            background: transparent;
            border: 1px solid var(--line-color);
            padding: 8px;
            border-radius: 0;
            font-family: var(--font-mono);
            font-size: 12px;
            cursor: pointer;
        }
        .toggle-row { display: flex; align-items: center; gap: 8px; font-size: 12px; border: 1px solid var(--line-color); padding: 8px; background: var(--bg-paper); cursor: pointer; }
        .toggle-box { width: 12px; height: 12px; border: 1px solid var(--bg-ink); }
        .toggle-row.checked .toggle-box { background: var(--accent); }

        /* --- INPUT --- */
        #input-zone {
            display: flex;
            height: 60px;
        }
        
        textarea {
            flex: 1;
            border: none;
            background: transparent;
            padding: 16px;
            font-family: var(--font-mono);
            font-size: 14px;
            resize: none;
            outline: none;
            color: var(--bg-ink);
        }
        textarea::placeholder { opacity: 0.4; text-transform: uppercase; }

        button#run-btn {
            width: 60px;
            border: none;
            border-left: 1px solid var(--line-color);
            background: transparent;
            color: var(--accent);
            font-weight: 900;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.1s;
        }
        button#run-btn:hover { background: var(--accent); color: white; }
        button#run-btn:disabled { color: #ccc; cursor: not-allowed; }

        /* Scrollbar Hiding */
        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-thumb { background: var(--line-color); }

    </style>
</head>
<body>

<div id="machine">
    
    <!-- 1. HEADER -->
    <header class="block">
        <div class="brand">RARO // Operator</div>
        <div class="meta">VER 3.01 // READY</div>
    </header>

    <!-- 2. OUTPUT STREAM -->
    <div id="output-tape">
        <div style="padding: 20px; text-align: center; opacity: 0.5; font-size: 12px;">
            WAITING FOR INPUT SEQUENCE...
        </div>
    </div>

    <!-- 3. PIPELINE (The Horizon) -->
    <div id="pipeline-strip">
        <div class="pipe-node" id="node-orch" onclick="toggleEditor('orch')">01_PLANNER</div>
        <div class="pipe-node" id="node-retr" onclick="toggleEditor('retr')">02_RETRIEVAL</div>
        <div class="pipe-node" id="node-synth" onclick="toggleEditor('synth')">03_SYNTHESIS</div>
    </div>

    <!-- 4. EDITOR DRAWER (Hidden by default) -->
    <div id="editor-drawer">
        <div style="padding: 8px 16px; border-bottom: 1px solid var(--line-color); font-size: 10px; text-transform: uppercase; font-weight: bold;">
            Configuring: <span id="editor-target">--</span>
        </div>
        <div class="editor-controls">
            <div class="control-group">
                <label>Model Runtime</label>
                <select class="brutalist-select" id="model-select">
                    <option>GEMINI-3-PRO</option>
                    <option>GEMINI-3-FLASH</option>
                    <option>GEMINI-3-DEEP-THINK</option>
                </select>
            </div>
            <div class="control-group">
                <label>Tools</label>
                <div class="toggle-row checked" onclick="this.classList.toggle('checked')">
                    <div class="toggle-box"></div>
                    <span>WEB_SEARCH</span>
                </div>
                <div style="height: 4px;"></div>
                <div class="toggle-row" onclick="this.classList.toggle('checked')">
                    <div class="toggle-box"></div>
                    <span>CODE_INTERP</span>
                </div>
            </div>
        </div>
    </div>

    <!-- 5. INPUT -->
    <div id="input-zone">
        <textarea id="cmd-input" placeholder="Type Research Directive..." onkeydown="handleKey(event)"></textarea>
        <button id="run-btn" onclick="execute()">â†µ</button>
    </div>

</div>

<script>
    let activeEditor = null;

    // --- Interaction: Graph Editor ---
    function toggleEditor(nodeId) {
        const drawer = document.getElementById('editor-drawer');
        const nodes = document.querySelectorAll('.pipe-node');
        
        // Reset states
        nodes.forEach(n => n.classList.remove('expanded'));

        if (activeEditor === nodeId) {
            // Close
            drawer.classList.remove('open');
            activeEditor = null;
        } else {
            // Open
            document.getElementById('editor-target').innerText = nodeId.toUpperCase();
            document.getElementById(`node-${nodeId}`).classList.add('expanded');
            drawer.classList.add('open');
            activeEditor = nodeId;
        }
    }

    function handleKey(e) {
        if(e.key === 'Enter' && !e.shiftKey) {
            e.preventDefault();
            execute();
        }
    }

    // --- Runtime Simulation ---
    async function execute() {
        const input = document.getElementById('cmd-input');
        const txt = input.value.trim();
        if(!txt) return;

        // Lock UI
        input.value = "";
        document.getElementById('run-btn').disabled = true;
        if(activeEditor) toggleEditor(activeEditor); // Close drawer if open
        
        // Clear empty state if exists
        const tape = document.getElementById('output-tape');
        if(tape.children[0].innerText.includes("WAITING")) tape.innerHTML = '';

        // 1. Log User Command
        printArtifact('USER', 'DIRECTIVE', txt, null);

        // 2. Planner
        await runNode('orch', 'PLANNER', 'Decomposing request. Strategy: Multi-hop retrieval on "'+txt+'".');
        
        // 3. Retrieval
        await runNode('retr', 'RETRIEVAL', 'Fetching 4 sources. \n> Source A (98%)\n> Source B (85%) \nVerifying signatures...');

        // 4. Synthesis
        const finalTxt = "Based on the retrieved context, the hypothesis is confirmed. The latency impact is negligible compared to the accuracy gains.";
        await runNode('synth', 'SYNTHESIS', finalTxt, 'sig_f9a2_final');

        document.getElementById('run-btn').disabled = false;
    }

    async function runNode(id, name, content, sig) {
        const el = document.getElementById(`node-${id}`);
        el.classList.add('running');
        
        // Sim latency
        await new Promise(r => setTimeout(r, 1200));

        el.classList.remove('running');
        
        // Print Output
        printArtifact('AGENT', name, content, sig || `sig_${Math.random().toString(36).substr(2,6)}`);
    }

    function printArtifact(type, label, text, sig) {
        const tape = document.getElementById('output-tape');
        const div = document.createElement('div');
        div.className = 'artifact';
        
        const tagClass = type === 'USER' ? 'user-tag' : 'role-tag';
        
        let sigBlock = '';
        if(type !== 'USER') {
            sigBlock = `
                <div class="signature-block">
                    <div class="sig-label">CTX_HASH</div>
                    <div class="sig-value">${sig}</div>
                </div>
            `;
        }

        div.innerHTML = `
            <div class="artifact-header">
                <span class="${tagClass}">${label}</span>
                <span>${new Date().toLocaleTimeString('en-US', {hour12:false})}</span>
            </div>
            <div class="artifact-body">${text.replace(/\n/g, '<br>')}</div>
            ${sigBlock}
        `;
        
        tape.appendChild(div);
        tape.scrollTop = tape.scrollHeight;
    }

</script>
</body>
</html>