<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RARO | Operator Console</title>
    <style>
        :root {
            /* === PALETTE: PHYSICAL (The Desk) === */
            --paper-bg: #EAE6DF;
            --paper-surface: #F2EFEA;
            --paper-ink: #1A1918;
            --paper-line: #A8A095;
            --paper-accent: #D4CDC5;
            
            /* === PALETTE: DIGITAL (The Machine) === */
            --digi-void: #090C10;
            --digi-panel: #161B22;
            --digi-line: #30363D;
            --arctic-cyan: #00F0FF;
            --arctic-dim: rgba(0, 240, 255, 0.08);
            --arctic-glow: rgba(0, 240, 255, 0.4);
            --alert-amber: #FFB300;
            
            /* === TYPE === */
            --font-ui: 'Inter', -apple-system, system-ui, sans-serif;
            --font-code: 'JetBrains Mono', 'Fira Code', monospace;
            
            /* === MOTION === */
            --ease-snap: cubic-bezier(0.16, 1, 0.3, 1);
        }

        * { box-sizing: border-box; }

        body {
            margin: 0;
            background: var(--paper-bg);
            color: var(--paper-ink);
            font-family: var(--font-ui);
            height: 100vh;
            display: flex;
            justify-content: center;
            overflow: hidden;
            /* Subtle grain texture overlay */
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)' opacity='0.03'/%3E%3C/svg%3E");
        }

        /* --- THE CHASSIS --- */
        #chassis {
            width: 100%;
            max-width: 800px;
            height: 100vh;
            border-left: 1px solid var(--paper-line);
            border-right: 1px solid var(--paper-line);
            background: var(--paper-bg);
            display: flex;
            flex-direction: column;
            position: relative;
            box-shadow: 0 0 100px rgba(0,0,0,0.1);
        }

        /* --- 1. OUTPUT STREAM (Top) --- */
        #output-pane {
            flex: 1;
            padding: 24px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            scroll-behavior: smooth;
        }

        /* Log Entries */
        .log-entry {
            border-top: 1px solid var(--paper-accent);
            padding: 12px 0;
            display: grid;
            grid-template-columns: 80px 1fr;
            gap: 16px;
            animation: slideUp 0.3s var(--ease-snap);
        }
        @keyframes slideUp { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .log-meta { font-family: var(--font-code); font-size: 10px; color: #888; text-transform: uppercase; letter-spacing: 0.5px; padding-top: 2px; }
        .log-role { font-weight: 700; color: var(--paper-ink); display: block; margin-bottom: 2px; }
        .log-content { font-size: 13px; line-height: 1.5; color: #333; }
        .log-content strong { color: #000; font-weight: 600; }

        /* --- 2. THE ARCTIC PIPELINE (Middle) --- */
        #pipeline-stage {
            height: 80px; /* Minimized Height */
            background: var(--digi-void);
            border-top: 1px solid var(--paper-line);
            border-bottom: 1px solid var(--paper-line);
            position: relative;
            z-index: 100;
            transition: height 0.5s var(--ease-snap);
            overflow: hidden;
            cursor: pointer;
            
            /* Digital Grid Background */
            background-image: 
                linear-gradient(var(--digi-line) 1px, transparent 1px),
                linear-gradient(90deg, var(--digi-line) 1px, transparent 1px);
            background-size: 40px 40px;
        }

        #pipeline-stage.expanded {
            height: 65vh; /* Expanded Height */
            cursor: default;
            box-shadow: 0 20px 80px rgba(0,0,0,0.4);
            border-top: 1px solid var(--digi-line);
        }

        /* The "HUD" Banner */
        #hud-banner {
            position: absolute; top: 0; left: 0; right: 0;
            height: 40px;
            background: rgba(22, 27, 34, 0.9);
            backdrop-filter: blur(8px);
            border-bottom: 1px solid var(--digi-line);
            display: flex; align-items: center; justify-content: space-between;
            padding: 0 16px;
            transform: translateY(-100%);
            transition: transform 0.3s ease;
            z-index: 200;
        }
        #pipeline-stage.expanded #hud-banner { transform: translateY(0); }

        .hud-title { 
            color: var(--arctic-cyan); font-family: var(--font-code); 
            font-size: 10px; letter-spacing: 1px; font-weight: 700; 
            display: flex; align-items: center; gap: 8px;
        }
        .hud-status-dot { width: 6px; height: 6px; background: var(--arctic-cyan); border-radius: 50%; box-shadow: 0 0 8px var(--arctic-cyan); }
        
        .btn-minimize {
            background: transparent; border: 1px solid var(--digi-line);
            color: #8B949E; font-size: 9px; padding: 4px 10px;
            text-transform: uppercase; cursor: pointer; transition: all 0.2s;
            font-family: var(--font-code);
        }
        .btn-minimize:hover { border-color: var(--arctic-cyan); color: white; background: var(--arctic-dim); }

        /* The Graph Layer */
        #graph-svg { width: 100%; height: 100%; position: absolute; top: 0; left: 0; }

        /* Nodes */
        .node {
            position: absolute;
            background: var(--digi-panel);
            border: 1px solid var(--digi-line);
            color: #8B949E;
            padding: 8px 12px;
            min-width: 120px;
            font-family: var(--font-code); font-size: 10px;
            text-align: center;
            transform: translate(-50%, -50%);
            transition: all 0.3s ease;
            user-select: none;
            pointer-events: none; /* Let clicks pass to container when min */
        }

        /* Interactive Nodes (Expanded) */
        #pipeline-stage.expanded .node { pointer-events: auto; cursor: pointer; }
        #pipeline-stage.expanded .node:hover { border-color: var(--arctic-cyan); color: white; }
        
        .node.selected { 
            border-color: var(--arctic-cyan); 
            background: var(--arctic-dim); 
            color: white; 
            box-shadow: 0 0 20px var(--arctic-dim); 
        }
        .node.running { 
            border-color: var(--alert-amber); 
            color: var(--alert-amber); 
            box-shadow: 0 0 15px rgba(255, 179, 0, 0.2); 
        }

        /* Cables */
        .cable { fill: none; stroke: var(--digi-line); stroke-width: 1.5px; transition: stroke 0.3s; }
        .cable.active { stroke: var(--arctic-cyan); stroke-dasharray: 6; animation: flow 0.8s linear infinite; }
        @keyframes flow { to { stroke-dashoffset: -12; } }

        /* --- 3. CONTROL DECK (Bottom) --- */
        #control-deck {
            height: 160px;
            background: var(--paper-bg);
            border-top: 1px solid var(--paper-line);
            display: flex; flex-direction: column;
            transition: height 0.5s var(--ease-snap);
            position: relative;
            z-index: 150;
        }

        /* Context-Aware Sizing */
        body.architect-mode #control-deck { height: 260px; }

        /* Deck Navigation */
        #deck-nav {
            height: 36px;
            background: var(--paper-surface);
            border-bottom: 1px solid var(--paper-line);
            display: flex;
        }
        
        .nav-item {
            flex: 1;
            display: flex; align-items: center; justify-content: center;
            font-size: 10px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;
            color: #888; cursor: pointer;
            border-right: 1px solid var(--paper-line);
            transition: all 0.2s;
        }
        .nav-item:hover { color: var(--paper-ink); background: white; }
        .nav-item.active { background: var(--paper-bg); color: var(--paper-ink); border-bottom: 2px solid var(--paper-ink); }
        .nav-item.action-close { max-width: 48px; color: #D32F2F; border-right: none; border-left: 1px solid var(--paper-line); }

        /* Content Panes */
        .deck-pane { display: none; height: 100%; padding: 20px; overflow-y: auto; }
        .deck-pane.active { display: block; }

        /* Input Pane (Default) */
        #pane-input { display: flex; flex-direction: column; padding: 0; }
        #cmd-input {
            flex: 1; border: none; background: transparent; padding: 20px;
            font-family: var(--font-code); font-size: 13px; color: var(--paper-ink);
            resize: none; outline: none;
        }
        #btn-run {
            height: 48px; border: none; border-top: 1px solid var(--paper-line);
            background: white; font-weight: 700; font-size: 11px; letter-spacing: 1px;
            cursor: pointer; transition: background 0.2s; color: var(--paper-ink);
        }
        #btn-run:hover { background: #F5F5F5; }

        /* Form Elements */
        .form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .form-group { margin-bottom: 16px; }
        label { display: block; font-size: 9px; color: #888; text-transform: uppercase; margin-bottom: 6px; font-weight: 600; }
        .input-std {
            width: 100%; padding: 10px; border: 1px solid var(--paper-line);
            background: white; font-family: var(--font-code); font-size: 12px;
            color: var(--paper-ink); outline: none;
        }
        .input-std:focus { border-color: var(--paper-ink); }
        .input-readonly { background: var(--paper-surface); color: #666; cursor: default; }

        /* Telemetry Cards */
        .stat-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; }
        .stat-card {
            border: 1px solid var(--paper-line); background: white; padding: 12px;
            text-align: center;
        }
        .stat-val { font-size: 16px; font-weight: 700; color: var(--paper-ink); display: block; }
        .stat-lbl { font-size: 9px; color: #888; text-transform: uppercase; margin-top: 4px; display: block; }

    </style>
</head>
<body>

<div id="chassis">
    
    <!-- 1. OUTPUT STREAM -->
    <div id="output-pane">
        <div class="log-entry">
            <div class="log-meta">SYSTEM_BOOT</div>
            <div>
                <span class="log-role">KERNEL</span>
                <div class="log-content">RARO Runtime Environment v4.0. <br>Status: <strong>IDLE</strong>. Pipeline ready for configuration.</div>
            </div>
        </div>
    </div>

    <!-- 2. ARCTIC PIPELINE CORE -->
    <div id="pipeline-stage" onclick="enterArchitectMode()">
        
        <!-- HUD Banner (Revealed on Expand) -->
        <div id="hud-banner">
            <div class="hud-title"><div class="hud-status-dot"></div> ARCHITECT VIEW // EDIT MODE</div>
            <button class="btn-minimize" onclick="exitArchitectMode(event)">▼ EXIT & MINIMIZE</button>
        </div>

        <!-- The Graph -->
        <svg id="graph-svg"></svg>
        <div id="nodes-layer"></div>
    </div>

    <!-- 3. CONTROL DECK -->
    <div id="control-deck">
        
        <!-- Navigation -->
        <div id="deck-nav" style="display:none">
            <!-- Global Tabs -->
            <div id="nav-global" style="display:contents">
                <div class="nav-item active" onclick="showPane('overview')">Overview</div>
                <div class="nav-item" onclick="showPane('sim')">Simulation</div>
                <div class="nav-item" onclick="showPane('stats')">Telemetry</div>
            </div>
            <!-- Node Specific Tabs -->
            <div id="nav-node" style="display:none; contents">
                <div class="nav-item active" style="flex:4; border-right:none; justify-content:flex-start; padding-left:20px; color:var(--paper-ink);">
                    COMPONENT SETTINGS
                </div>
                <div class="nav-item action-close" onclick="deselectNode()">×</div>
            </div>
        </div>

        <!-- PANE: INPUT (Default Minimized) -->
        <div id="pane-input" class="deck-pane active" style="padding:0; display:flex;">
            <textarea id="cmd-input" placeholder=">> Enter research directive or click pipeline to configure..."></textarea>
            <button id="btn-run" onclick="executeRun()">INITIATE RUN</button>
        </div>

        <!-- PANE: OVERVIEW (Expanded Global) -->
        <div id="pane-overview" class="deck-pane">
            <div class="form-grid">
                <div class="form-group">
                    <label>Pipeline Identifier</label>
                    <input class="input-std" value="Research_Synthesis_Alpha">
                </div>
                <div class="form-group">
                    <label>Max Token Budget</label>
                    <input class="input-std" value="128,000">
                </div>
                <div class="form-group">
                    <label>Latency Timeout (ms)</label>
                    <input class="input-std" value="15000">
                </div>
                <div class="form-group">
                    <label>Persistence Layer</label>
                    <select class="input-std">
                        <option>Redis (Hot)</option>
                        <option>PostgreSQL (Cold)</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- PANE: SIMULATION (Expanded Global) -->
        <div id="pane-sim" class="deck-pane">
            <div style="display:flex; gap:10px; margin-bottom:15px;">
                <button class="input-std" style="width:auto; cursor:pointer; background:#1a1918; color:white;" onclick="log('Simulating step 1...')">▶ STEP EXECUTION</button>
                <button class="input-std" style="width:auto; cursor:pointer;" onclick="log('Resetting context...')">↺ RESET CONTEXT</button>
            </div>
            <div style="font-family:var(--font-code); font-size:11px; color:#555; background:white; border:1px solid var(--paper-line); padding:10px; height:100px; overflow-y:auto;">
                > Ready for test vector injection...<br>
                > Agents loaded: 4
            </div>
        </div>

        <!-- PANE: TELEMETRY (Expanded Global) -->
        <div id="pane-stats" class="deck-pane">
            <div class="stat-grid">
                <div class="stat-card">
                    <span class="stat-val">98ms</span>
                    <span class="stat-lbl">P99 Latency</span>
                </div>
                <div class="stat-card">
                    <span class="stat-val">94.2%</span>
                    <span class="stat-lbl">Cache Hit</span>
                </div>
                <div class="stat-card">
                    <span class="stat-val">$0.002</span>
                    <span class="stat-lbl">Cost/Run</span>
                </div>
                <div class="stat-card">
                    <span class="stat-val">0</span>
                    <span class="stat-lbl">Errors</span>
                </div>
            </div>
        </div>

        <!-- PANE: NODE CONFIG (Node Selected) -->
        <div id="pane-node-config" class="deck-pane">
            <div class="form-grid">
                <div class="form-group">
                    <label>Agent ID</label>
                    <input class="input-std input-readonly" id="cfg-id" readonly>
                </div>
                <div class="form-group">
                    <label>Model Runtime</label>
                    <select class="input-std" id="cfg-model">
                        <option>GEMINI-3-PRO</option>
                        <option>GEMINI-3-FLASH</option>
                        <option>GEMINI-3-DEEP-THINK</option>
                    </select>
                </div>
            </div>
            <div class="form-group">
                <label>System Instruction (Prompt)</label>
                <textarea class="input-std" id="cfg-prompt" style="height:80px; resize:none;"></textarea>
            </div>
        </div>

    </div>

</div>

<script>
    // --- 1. DATA MODEL ---
    const nodes = [
        { id: 'n1', label: 'ORCHESTRATOR', x: 20, y: 50, model: 'GEMINI-3-PRO', prompt: 'Determine optimal sub-tasks.' },
        { id: 'n2', label: 'RETRIEVAL', x: 50, y: 30, model: 'GEMINI-3-FLASH', prompt: 'Query vector database.' },
        { id: 'n3', label: 'CODE_INTERP', x: 50, y: 70, model: 'GEMINI-3-FLASH', prompt: 'Execute Python analysis.' },
        { id: 'n4', label: 'SYNTHESIS', x: 80, y: 50, model: 'GEMINI-3-DEEP-THINK', prompt: 'Compile final report.' }
    ];
    
    const links = [
        { from: 'n1', to: 'n2' }, { from: 'n1', to: 'n3' },
        { from: 'n2', to: 'n4' }, { from: 'n3', to: 'n4' }
    ];

    let state = {
        expanded: false,
        selectedNode: null
    };

    // --- 2. RENDER ENGINE ---
    function render() {
        const svg = document.getElementById('graph-svg');
        const layers = document.getElementById('nodes-layer');
        const container = document.getElementById('pipeline-stage');
        
        svg.innerHTML = '';
        layers.innerHTML = '';
        
        const w = container.clientWidth;
        const h = container.clientHeight;

        // Draw Links
        links.forEach(l => {
            const n1 = nodes.find(n => n.id === l.from);
            const n2 = nodes.find(n => n.id === l.to);
            
            // Dynamic Y calculation based on state
            const getY = (n) => state.expanded ? (n.y / 100) * h : h / 2;
            const getX = (n) => (n.x / 100) * w;

            const path = document.createElementNS("http://www.w3.org/2000/svg", "path");
            const d = `M ${getX(n1)} ${getY(n1)} C ${getX(n1)+60} ${getY(n1)}, ${getX(n2)-60} ${getY(n2)}, ${getX(n2)} ${getY(n2)}`;
            
            path.setAttribute("d", d);
            path.setAttribute("class", "cable");
            path.setAttribute("id", `link-${l.from}-${l.to}`);
            svg.appendChild(path);
        });

        // Draw Nodes
        nodes.forEach(n => {
            const el = document.createElement('div');
            el.className = `node ${state.selectedNode === n.id ? 'selected' : ''}`;
            el.innerText = n.label;
            el.id = `node-${n.id}`;
            
            const px = (n.x / 100) * w;
            const py = state.expanded ? (n.y / 100) * h : h / 2;
            
            el.style.left = `${px}px`; 
            el.style.top = `${py}px`;

            el.onclick = (e) => {
                if(!state.expanded) return;
                e.stopPropagation();
                selectNode(n.id);
            };

            layers.appendChild(el);
        });
    }

    // --- 3. STATE LOGIC ---

    // Transition: IDLE -> ARCHITECT
    function enterArchitectMode() {
        if(state.expanded) return;
        state.expanded = true;
        document.body.classList.add('architect-mode');
        document.getElementById('pipeline-stage').classList.add('expanded');
        
        // Swap Deck to Global Tabs
        document.getElementById('pane-input').classList.remove('active');
        document.getElementById('deck-nav').style.display = 'flex';
        showPane('overview');

        animateGraph();
    }

    // Transition: ARCHITECT -> IDLE
    function exitArchitectMode(e) {
        if(e) e.stopPropagation();
        state.expanded = false;
        state.selectedNode = null;
        document.body.classList.remove('architect-mode');
        document.getElementById('pipeline-stage').classList.remove('expanded');
        
        // Swap Deck to Input
        document.getElementById('deck-nav').style.display = 'none';
        hideAllPanes();
        document.getElementById('pane-input').classList.add('active');
        document.getElementById('nav-node').style.display = 'none';
        document.getElementById('nav-global').style.display = 'contents';

        animateGraph();
    }

    // Transition: ARCHITECT -> CONFIG
    function selectNode(id) {
        state.selectedNode = id;
        
        // Update Nav
        document.getElementById('nav-global').style.display = 'none';
        document.getElementById('nav-node').style.display = 'flex';
        
        // Show Config Pane
        hideAllPanes();
        document.getElementById('pane-node-config').classList.add('active');

        // Populate Data
        const n = nodes.find(x => x.id === id);
        document.getElementById('cfg-id').value = n.label;
        document.getElementById('cfg-model').value = n.model;
        document.getElementById('cfg-prompt').value = n.prompt;

        render();
    }

    function deselectNode() {
        state.selectedNode = null;
        // Revert to Global
        document.getElementById('nav-node').style.display = 'none';
        document.getElementById('nav-global').style.display = 'contents';
        showPane('overview');
        render();
    }

    // --- 4. UTILITIES ---

    function showPane(id) {
        hideAllPanes();
        document.getElementById(`pane-${id}`).classList.add('active');
        
        // Update Tabs
        document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
        // (Simple index matching for demo purposes)
        if(id === 'overview') document.querySelectorAll('.nav-item')[0].classList.add('active');
        if(id === 'sim') document.querySelectorAll('.nav-item')[1].classList.add('active');
        if(id === 'stats') document.querySelectorAll('.nav-item')[2].classList.add('active');
    }

    function hideAllPanes() {
        document.querySelectorAll('.deck-pane').forEach(el => el.classList.remove('active'));
    }

    function animateGraph() {
        // Double render to catch CSS transition steps
        setTimeout(render, 50);
        setTimeout(render, 150);
        setTimeout(render, 300);
        setTimeout(render, 500);
    }

    function log(msg) {
        const out = document.getElementById('output-pane');
        const div = document.createElement('div');
        div.className = 'log-entry';
        div.innerHTML = `
            <div class="log-meta">${new Date().toLocaleTimeString('en-US', {hour12:false})}</div>
            <div>
                <span class="log-role">SYSTEM</span>
                <div class="log-content">${msg}</div>
            </div>
        `;
        out.appendChild(div);
        out.scrollTop = out.scrollHeight;
    }

    function executeRun() {
        const val = document.getElementById('cmd-input').value;
        if(!val) return;
        
        // User Log
        const out = document.getElementById('output-pane');
        const div = document.createElement('div');
        div.className = 'log-entry';
        div.innerHTML = `
            <div class="log-meta">USER_INPUT</div>
            <div>
                <span class="log-role">OPERATOR</span>
                <div class="log-content"><strong>${val}</strong></div>
            </div>
        `;
        out.appendChild(div);
        document.getElementById('cmd-input').value = "";
        out.scrollTop = out.scrollHeight;

        // Visual Feedback (Min mode)
        if(!state.expanded) {
            highlightNode('n1');
            setTimeout(() => { highlightNode('n2'); highlightNode('n3'); }, 800);
            setTimeout(() => highlightNode('n4'), 1600);
            setTimeout(() => log("Synthesis complete. 1284 tokens consumed."), 2400);
        }
    }

    function highlightNode(id) {
        const el = document.getElementById(`node-${id}`);
        if(el) {
            el.classList.add('running');
            setTimeout(() => el.classList.remove('running'), 600);
        }
        // Also trigger cable
        const link = document.querySelector(`path[id^='link-${id}']`);
        if(link) {
            link.classList.add('active');
            setTimeout(() => link.classList.remove('active'), 600);
        }
    }

    // --- INIT ---
    window.onload = render;
    window.onresize = render;

</script>
</body>
</html>